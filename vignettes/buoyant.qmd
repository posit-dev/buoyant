---
title: "Getting Started with buoyant"
vignette: >
  %\VignetteIndexEntry{Getting Started with buoyant}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
knitr:
  opts_chunk:
    collapse: true
    comment: '#>'
    eval: false
---

This guide walks you through deploying your first `_server.yml` application using `buoyant`.

## What is buoyant?

`buoyant` is an R package for deploying web server applications to DigitalOcean. It works with any R web framework that implements the `_server.yml` standard, including:

- [plumber2](https://plumber2.posit.co) - Modern R API framework
- [fiery](https://fiery.data-imaginist.com) - Flexible web server framework
- Any custom package implementing the `_server.yml` standard

When you deploy an application with `buoyant`:

1. Your application files are uploaded to the server
2. The engine package is installed if not present
3. A systemd service is created for automatic restarts
4. Nginx is configured as a reverse proxy
5. Your application is accessible via HTTP (or HTTPS with `do_configure_https()`)

## The `_server.yml` Standard

The `_server.yml` standard is a lightweight specification that allows different R web frameworks to be deployed consistently. At minimum, your application needs a `_server.yml` file with an `engine` field:

```yaml
engine: plumber2
```

Each engine can define additional configuration fields. For example, a plumber2 application might have:

```yaml
engine: plumber2
```

The engine package must export a `launch_server(settings, host = NULL, port = NULL, ...)` function that:
- Accepts the path to `_server.yml` as the first argument
- Can override host and port via parameters
- Starts the web server

## Prerequisites

1. **R** (>= 3.0.0)
2. **DigitalOcean Account** - Sign up at <https://www.digitalocean.com>
3. **SSH Keys** - Configure SSH keys for your system

## Installation

```{r}
# Install dependencies
install.packages(c("analogsea", "yaml", "ssh", "jsonlite"))

# Install buoyant (adjust path as needed)
devtools::install_local("path/to/buoyant")
```

## Step 1: Create Your Application

Create a `_server.yml` compliant application. For example, with plumber2:

```{yaml}
#| file: _server.yml
engine: plumber2
```

```{r}
#| file: plumber.R
#* @get /hello
function() {
  list(message = "Hello from buoyant!")
}

#* @get /add
#* @param a First number
#* @param b Second number
function(a, b) {
  result <- as.numeric(a) + as.numeric(b)
  list(result = result)
}
```

## Step 2: Test Locally (Optional)

If you have plumber2 installed:

```{r}
library(plumber2)
api("plumber.R") |> api_run()
```

Visit <http://127.0.0.1:8080/api-docs> to see your API documentation.

## Step 3: Set Up DigitalOcean

```{r}
library(analogsea)

# Authenticate with DigitalOcean
# This will open a browser for authentication
do_oauth()

# Check authentication
droplets() # Should return a list (may be empty)
```

### Configure SSH Keys

Make sure you provide digitial ocean your public key at https://cloud.digitalocean.com/ssh_keys. Github has some good advice on creating a new public key if you don't already have one: https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent.

Be sure to store your `Host` to `digitalocean.com` and point to your private key that you created:

```
Host github.com
  UseKeychain yes
  IdentityFile ~/.ssh/newly_created_key_file
```

If you didn't use a password when creating your SSH key, you can skip the `UseKeychain` line.

You can verify your DigitalOcean SSH key exists with the proper host with by calling `buoyant::do_keyfile()`.

## Step 4: Provision a Server

```{r}
library(buoyant)

# This will cost money! Check DigitalOcean pricing first.
# A basic droplet costs around $6/month (as of 2025)

droplet <- do_provision(
  name = "my-api-server",
  region = "sfo3", # San Francisco
  size = "s-1vcpu-1gb" # Basic tier
)

# This will take a few minutes...
# It installs R, nginx, firewall, and sets up the server structure
```

## Step 5: Deploy Your Application

```{r}
# Validate your _server.yml file first
validate_server_yml("./")

# Deploy!
do_deploy_server(
  overwrite = TRUE,
  droplet = droplet,
  path = "api", # URL sub-path: /api
  local_path = "./_dev/barret", # Local directory
  port = 8000, # Internal port
  forward = TRUE # Make it accessible at root too
)
```

The deployment process:

1. Uploads your application files
2. Installs the engine package (plumber2)
3. Creates a systemd service for auto-restart
4. Configures nginx as a reverse proxy
5. Starts your application

## Step 6: Access Your API

```{r}
# Get the URL
url <- do_ip(droplet, "/api")
print(url) # e.g., "http://165.232.134.23/api"

# Open in browser
browseURL(paste0(url, "/hello"))

# Or use httr to test
library(httr)
GET(paste0(url, "/hello"))
GET(paste0(url, "/add?a=5&b=3"))
```

## Step 7: Monitor Your Application

SSH into your droplet to check logs:

```{r}
droplet_ssh(droplet, "journalctl -u server-api -f")
```

Or use analogsea's convenience functions:

```{r}
# Check if service is running
droplet_ssh(droplet, "systemctl status server-api")
```

## Optional: Add HTTPS

If you have a domain name:

```{r}
# Point your domain to the droplet IP
ip <- do_ip(droplet)
print(ip)

# After DNS is configured (wait for propagation):
do_configure_https(
  droplet = droplet,
  domain = "api.yourdomain.com",
  email = "you@example.com",
  terms_of_service = TRUE # Agree to Let's Encrypt TOS
)
```

Now your API is available at `https://api.yourdomain.com/api`

## What's Next?

You've successfully deployed your first application! Here are some next steps:

- **Update your application**: Redeploy with `overwrite = TRUE` when you make changes
- **Deploy multiple apps**: Use different ports and paths on the same droplet
- **Add HTTPS**: Use `do_configure_https()` with your domain name
- **Monitor your app**: Check logs with `journalctl -u server-myapp`

For detailed information, see:

- **[Advanced Usage](advanced-usage.html)** - Managing deployments, multiple apps, HTTPS, and more
- **[Troubleshooting](troubleshooting.html)** - Common issues and solutions


## Getting Help

- Package issues: <https://github.com/posit-dev/buoyant/issues>
- DigitalOcean docs: <https://docs.digitalocean.com>
- plumber2 docs: <https://plumber2.posit.co>
- analogsea docs: <https://github.com/sckott/analogsea>
- `_server.yml` specification: <https://plumber2.posit.co/articles/server_yml.html>
