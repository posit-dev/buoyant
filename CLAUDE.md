# buoyant Package Summary

## Overview

`buoyant` is an R package for deploying `_server.yml` compliant web applications to DigitalOcean. It supports any R web framework that implements the `_server.yml` standard (plumber2, fiery, etc.).

## Development Commands

### Testing
- `devtools::check()` - Run full R CMD check (standard R package check)
- `devtools::test()` - Run unit tests using testthat
- `devtools::test(filter = "then")` - Run tests matching pattern (e.g., all tests in test-then.R)
- `testthat::test_file("tests/testthat/test-*.R")` - Run a single test file
- `spelling::spell_check_test(vignettes = TRUE, error = TRUE, skip_on_cran = TRUE)` - Check spelling

### Package Development
- `devtools::load_all()` - Load package for development
- `devtools::document()` - Generate documentation from roxygen2 comments
- `devtools::build()` - Build source package
- `devtools::install()` - Install package locally
- `pkgdown::build_site()` - Build package documentation website

### GitHub Actions
The package uses RStudio's shiny-workflows for CI/CD:
- Automated R CMD check on push/PR
- Website deployment via pkgdown
- Code formatting checks

## Package Structure

```
buoyant/
├── DESCRIPTION              # Package metadata
├── NAMESPACE               # Exported functions
├── LICENSE                 # MIT License
├── LICENSE.md
├── README.md               # Main documentation
├── NEWS.md                 # Release notes
├── .Rbuildignore
├── .gitignore
│
├── R/                      # R source code
│   ├── validate.R          # _server.yml validation functions
│   ├── digital-ocean.R     # DigitalOcean deployment functions
│   └── utils.R             # Utility functions
│
├── inst/                   # Installed files
│   └── server/             # Server configuration templates
│       ├── nginx.conf      # Nginx configuration
│       └── nginx-ssl.conf  # Nginx SSL configuration
│
├── man/                    # Documentation (generated by roxygen2)
│
└── tests/                  # Unit tests
    ├── testthat.R
    └── testthat/
        └── test-validate.R
```

## Exported Functions

### Deployment Functions
- `do_provision()` - Provision a DigitalOcean droplet with R and dependencies
- `do_deploy_server()` - Deploy a _server.yml application to a droplet
- `do_remove_server()` - Remove a deployed application
- `do_configure_https()` - Add HTTPS/SSL support via Let's Encrypt
- `do_forward()` - Forward root path to an application
- `do_remove_forward()` - Remove root path forwarding
- `do_install_server_deps()` - Install server dependencies
- `do_ip()` - Get the URL to access a deployed application

### Validation Functions
- `validate_server_yml()` - Validate a _server.yml file
- `read_server_yml()` - Read and parse a _server.yml configuration

## Key Features

1. **Framework Agnostic**: Works with any _server.yml compliant engine
2. **Easy Deployment**: One function call to deploy an application
3. **Automatic Setup**: Creates systemd services and nginx configuration
4. **HTTPS Support**: Easy Let's Encrypt integration
5. **Multiple Apps**: Deploy multiple applications to one server
6. **Validation**: Validate configurations before deployment

## Dependencies

- `analogsea` (>= 0.9.4) - DigitalOcean API client
- `ssh` - SSH client for remote operations
- `yaml` - YAML parsing
- `jsonlite` - JSON operations
- `lifecycle` - Deprecation management
- `utils` - Base utilities

## Deployment Workflow

1. **Validate** the _server.yml file with `validate_server_yml()`
2. **Provision** a DigitalOcean server with `do_provision()`
3. **Deploy** the application with `do_deploy_server()`
4. **Access** via the URL from `do_ip()`
5. **Monitor** using SSH and systemd commands
6. **Update** by redeploying with `overwrite = TRUE`
7. **Remove** with `do_remove_server()` when done

## How It Works

When you deploy an application:

1. Application files are uploaded to `/var/server-apps/<path>/`
2. The engine package is installed if not present
3. A systemd service is created that runs:
   ```r
   engine <- yaml::read_yaml('_server.yml')$engine
   launch_server <- get('launch_server', envir = asNamespace(engine))
   launch_server('_server.yml', host = '127.0.0.1', port = <port>)
   ```
4. Nginx is configured to proxy requests to the application
5. The service is started and enabled for auto-restart

## Comparison with plumberDeploy

| Feature | buoyant | plumberDeploy |
|---------|---------|---------------|
| Framework Support | Any _server.yml engine | plumber only |
| Configuration | _server.yml standard | plumber.R files |
| Deployment Targets | DigitalOcean | DigitalOcean |
| HTTPS Support | Yes (Let's Encrypt) | Yes (Let's Encrypt) |
| Multiple Apps | Yes | Yes |

## Testing

The package includes unit tests for:
- Validation functions (detecting errors, parsing configs)

Run tests with:
```r
devtools::test()
```

## Documentation

- `README.md` - Complete package documentation and API reference
- `NEWS.md` - Version history and changes
- Function documentation via roxygen2 (use `?function_name`)

## Future Enhancements

Potential additions:
- Support for additional deployment targets (AWS, Azure, Heroku)
- Docker container generation
- Load balancing configuration
- Database setup helpers
- Monitoring and logging integration
- CI/CD pipeline templates

## License

MIT License - See LICENSE.md for details

## Acknowledgments

Inspired by [plumberDeploy](https://github.com/meztez/plumberDeploy) by Bruno Tremblay and Jeff Allen.

The _server.yml standard was developed as part of the [plumber2](https://plumber2.posit.co) project.
